<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.d82bea9fb325cd6d4780.css" data-identity="gatsby-global-css">p,pre,ul{margin-top:0}code,pre{background-color:#f9f9f9}img,pre{display:block}*{box-sizing:border-box}body,html{margin:0;overflow-x:hidden;padding:0}html{font-size:16px;line-height:1.5}@media (min-width:38em){html{font-size:20px}}body{-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;background-color:#fff;color:#515151}a{color:#268bd2}a:focus,a:hover{text-decoration:underline}h1,h2,h3{text-rendering:optimizeLegibility;line-height:1.25;margin-bottom:.5rem}.highlight,p,pre,ul{margin-bottom:1rem}h1{font-size:2rem}h2{font-size:1.5rem;margin-top:1rem}h3{font-size:1.25rem;margin-top:1.5rem}code,pre{font-family:Menlo,Monaco,Courier New,monospace}code{border-radius:3px;color:#bf616a;font-size:85%;padding:.25em .5em}pre{word-wrap:break-word;font-size:.8rem;line-height:1.4;padding:1rem;white-space:pre;white-space:pre-wrap;word-break:break-all}pre code{background-color:transparent;color:inherit;font-size:100%;padding:0}.highlight{border-radius:4px}.highlight pre,blockquote p:last-child{margin-bottom:0}blockquote{border-left:.25rem solid #e5e5e5;color:#7a7a7a;margin:.8rem 0;padding:.5rem 1rem}@media (min-width:30em){blockquote{padding-left:1.25rem;padding-right:5rem}}img{border-radius:5px;margin:0 0 1rem;max-width:100%}.container{margin-left:auto;margin-right:auto;max-width:28rem;padding-left:1rem;padding-right:1rem}.highlight .k{color:#069}.highlight .o{color:#555}.highlight .c1{color:#999}.highlight .kd{color:#069}.highlight .na{color:#4f9fcf}.highlight .nt{color:#2f6f9f}.highlight .w{color:#bbb}.highlight .s1,.highlight .s2{color:#c30}html{font-family:"PT Serif",Georgia,Times New Roman,serif}.pagination,.sidebar,h1,h2,h3{font-family:PT Sans,Helvetica,Arial,sans-serif}h1,h2,h3{color:#313131;font-weight:400;letter-spacing:-.025rem}.wrap{position:relative;width:100%}@media (min-width:38em){.container{max-width:32rem}}@media (min-width:56em){.container{max-width:38rem}}.masthead{border-bottom:1px solid #eee;margin-bottom:3rem;padding-bottom:1rem;padding-top:1rem}.masthead-title,.sidebar-item p:last-child{margin-bottom:0}.masthead-title{color:#505050;margin-top:0}.masthead-title a{color:#505050}.masthead-title small{color:silver;font-size:75%;font-weight:400;letter-spacing:0}@media (max-width:48em){.masthead-title{text-align:center}.masthead-title small{display:none}}.sidebar{background-color:#202020;bottom:0;color:rgba(255,255,255,.6);font-size:.875rem;left:-14rem;overflow-y:auto;position:fixed;top:0;transition:all .3s ease-in-out;visibility:hidden;width:14rem}.sidebar a{color:#fff;font-weight:400}.sidebar-item{padding:1rem}.sidebar-nav{border-bottom:1px solid rgba(255,255,255,.1)}.sidebar-nav-item{border-top:1px solid rgba(255,255,255,.1);display:block;padding:.5rem 1rem}a.sidebar-nav-item:focus,a.sidebar-nav-item:hover{background-color:rgba(255,255,255,.1);border-color:transparent;text-decoration:none}@media (min-width:48em){.sidebar-item{padding:1.5rem}.sidebar-nav-item{padding-left:1.5rem;padding-right:1.5rem}}.sidebar-checkbox{opacity:0;position:absolute;-webkit-user-select:none;-ms-user-select:none;user-select:none}.sidebar-toggle{background-color:#fff;border-radius:.25rem;color:#505050;cursor:pointer;display:block;left:1rem;padding:.25rem .75rem;position:absolute;top:.8rem}.sidebar-toggle:before{background-image:linear-gradient(180deg,#555,#555 20%,#fff 0,#fff 40%,#555 0,#555 60%,#fff 0,#fff 80%,#555 0,#555);content:"";display:inline-block;height:.75rem;width:1rem}#sidebar-checkbox:checked~.sidebar-toggle,#sidebar-checkbox:focus~.sidebar-toggle,.sidebar-toggle:active{background-color:#555;color:#fff}#sidebar-checkbox:checked~.sidebar-toggle:before,#sidebar-checkbox:focus~.sidebar-toggle:before,.sidebar-toggle:active:before{background-image:linear-gradient(180deg,#fff,#fff 20%,#555 0,#555 40%,#fff 0,#fff 60%,#555 0,#555 80%,#fff 0,#fff)}@media (min-width:30.1em){.sidebar-toggle{position:fixed}}@media print{.sidebar-toggle{display:none}}.sidebar,.sidebar-toggle,.wrap{-webkit-backface-visibility:hidden;backface-visibility:hidden}.sidebar-toggle,.wrap{transition:-webkit-transform .3s ease-in-out;transition:transform .3s ease-in-out;transition:transform .3s ease-in-out,-webkit-transform .3s ease-in-out}#sidebar-checkbox:checked+.sidebar{visibility:visible;z-index:10}#sidebar-checkbox:checked~.sidebar,#sidebar-checkbox:checked~.sidebar-toggle,#sidebar-checkbox:checked~.wrap{-webkit-transform:translateX(14rem);transform:translateX(14rem)}.post{margin-bottom:4em}.post-title,.post-title a{color:#303030}.post-title{margin-top:0}.post-meta{color:#9a9a9a;display:block;margin-bottom:1rem;margin-top:-.5rem}.pagination{color:#ccc;margin-left:-1rem;margin-right:-1rem;overflow:hidden;text-align:center}.pagination-item{border:1px solid #eee;display:block;padding:1rem}.pagination-item:first-child{margin-bottom:-1px}a.pagination-item:hover{background-color:#f5f5f5}@media (min-width:30em){.sidebar{font-size:.75rem}.pagination{margin:3rem 0}.pagination-item{float:left;width:50%}.pagination-item:first-child{border-bottom-left-radius:4px;border-top-left-radius:4px;margin-bottom:0}.pagination-item:last-child{border-bottom-right-radius:4px;border-top-right-radius:4px;margin-left:-1px}}@font-face{font-family:PT Sans;font-style:normal;font-weight:400;src:local("PT Sans"),local("PTSans-Regular"),url(https://fonts.gstatic.com/s/ptsans/v8/FUDHvzEKSJww3kCxuiAo2A.ttf) format("truetype")}@font-face{font-family:"PT Serif";font-style:normal;font-weight:400;src:local("PT Serif"),local("PTSerif-Regular"),url(https://fonts.gstatic.com/s/ptserif/v8/EgBlzoNBIHxNPCMwXaAhYPesZW2xOQ-xsNqO47m55DA.ttf) format("truetype")}@font-face{font-family:"PT Serif";font-style:normal;font-weight:700;src:local("PT Serif Bold"),local("PTSerif-Bold"),url(https://fonts.gstatic.com/s/ptserif/v8/QABk9IxT-LFTJ_dQzv7xpJ0EAVxt0G0biEntp43Qt6E.ttf) format("truetype")}@font-face{font-family:"PT Serif";font-style:italic;font-weight:400;src:local("PT Serif Italic"),local("PTSerif-Italic"),url(https://fonts.gstatic.com/s/ptserif/v8/03aPdn7fFF3H6ngCgAlQzC3USBnSvpkopQaUR-2r7iU.ttf) format("truetype")}body{background:#fff;font:16px Open Sans,Helvetica,Arial,sans-serif;line-height:1.4;margin:0 0 100px}em{color:#999}p{font-size:90%;line-height:1.6}a{color:#2c85b1;font-weight:400;text-decoration:none}ul{margin-bottom:0}section{margin:1em 0 2em}blockquote{margin:0 0 1em}.resume-module--resumeStyle--1CoY1{margin:2em 2em 2em 2.5em;max-width:760px}.resume-module--heading--2FRdI header h1{font-size:180%;font-weight:600;margin:.5em 0}.resume-module--heading--2FRdI header h2{font-size:140%;font-weight:400;margin:0}.resume-module--contact_detail--1eZqg{margin:0 1em 0 0}.resume-module--profile--EPFGz,.resume-module--profile--EPFGz span,.resume-module--profile--EPFGz strong{display:inline-block;margin:0 1em 0 0}section h2{color:#bc1b39;font-size:140%;font-weight:400;margin:0 0 1em;text-transform:uppercase}.resume-module--item--1jFCJ{border-bottom:1px solid #f2ebec;margin:0 0 1em;padding:0 0 1em}.resume-module--item--1jFCJ:last-child{border-bottom:none}.resume-module--item--1jFCJ header h3{display:inline-block;font-weight:600;margin:.2em 1em .2em 0}.resume-module--item--1jFCJ header a{display:inline-block}.resume-module--item_position--3bvRl{font-size:100%;font-weight:600;margin:.2em 1em .2em 0}.resume-module--item_dates--bsASf{color:#6b6b6b}.resume-module--item_highlights--3pYgh{font-size:90%;list-style:square}.resume-module--skills_item--iBZjq{font-size:90%;margin:.5em 0;padding:0 0 .5em}.resume-module--skills_item_name--BRPMR{display:inline-block;font-weight:600;margin:0 1em 0 0;text-transform:uppercase;vertical-align:top;width:23%}.resume-module--skills_item_keywords--2Le1r{display:inline-block;vertical-align:top;width:70%}#resume-module--education--2hmQ2 .resume-module--item--1jFCJ{border-bottom:0;display:inline-block;vertical-align:top;width:49.5%}</style><meta name="generator" content="Gatsby 3.9.1"/><link as="script" rel="preload" href="/webpack-runtime-252066672f8c7e61a796.js"/><link as="script" rel="preload" href="/framework-ef6b9b91ed0b2fec9a9f.js"/><link as="script" rel="preload" href="/app-3bab03752071a27f3420.js"/><link as="script" rel="preload" href="/component---src-templates-blog-page-js-f50b6c64133b0f8a57d3.js"/><link as="fetch" rel="preload" href="/page-data/tutorials/environmental-variables-for-angularjs/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="mainContainer"><input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"/><div class="sidebar"><nav class="sidebar-nav"><div class="sidebar-item"><p>Software development for Everyone else</p></div><a class="sidebar-nav-item" href="/resume">Resume</a><a class="sidebar-nav-item" href="/projects">Projects</a><a class="sidebar-nav-item" href="/blog">Blog</a><span class="sidebar-nav-item">Outer Links</span><a href="https://github.com/tomcentrate" class="sidebar-nav-item">Github</a><a href="https://www.linkedin.com/in/tommy-lee-a23ba935/" class="sidebar-nav-item">LinkedIn</a></nav></div><div class="wrap"><div class="masthead"><div class="container"><h3 class="masthead-title"><a title="Home" href="/">Tommy Lee</a><small>Software development for everyone else</small></h3></div></div><div class="container content"><h1 class="post-title">Environmental Variables for AngularJS</h1><article class="post"><span class="post-meta"><span class="post-date">10 February, 2016</span></span><div><p>When it came time to setup deploys for our AngularJS application, we had a few areas in our Services that had hard-coded API keys into the application. A lot of guides online have different ways of incorporating ng-constant into the build process. At <a href="http://frshlns.com/">Fresh Lines</a>, I work on a lot of server-side projects. I'm comfortable with a standard convention for my configurations, like a /config folder to store environment based settings.</p>
<p>This particular setup is based on <a href="http://onefootball.github.io/environment-dependent-configuration-files-with-angularjs-and-grunt/">onefootball</a>'s guide, and mirrors closely to how some server side frameworks have handled their environmental variables.</p>
<h2>Intended Usage</h2>
<p>I want to have a nice config file, that lists all my environment specific settings, like</p>
<p>{% highlight json %}
{
"business": {
"url": "<a href="http://tommylee.co">http://tommylee.co</a>"
}
}
{% endhighlight %}
and in config.production.json.
{% highlight json %}
{
"business": {
"url": "<a href="http://frshlns.com">http://frshlns.com</a>"
}
}
{% endhighlight %}</p>
<p>then have the ability to inject the configuration into places where I need it.</p>
<p>{% highlight javascript %}
var app = angular.module('brandtinker.businessFactory',['config']);</p>
<p>function BusinessFactory($http, $q, ENV) {
var url = ENV.business.url;
...
}
{% endhighlight %}</p>
<h2>Requirements</h2>
<ul>
<li>An AngularJS Application</li>
<li>A (Gruntfile)<a href="https://github.com/werk85/grunt-ng-constant">gruntjs</a> that works</li>
</ul>
<h3>Folder Structure</h3>
<p>The project folders would be set up so that we have a separate config folder to hold all of the private information:</p>
<p>{% highlight bash %}
/app
/config
/Gruntfile.js
{% endhighlight %}</p>
<p>In this config folder, we'll have the following files. These files represent the different environments we want.</p>
<p>{% highlight bash %}
./config.json
./config.production.json
./config.development.json
./config.staging.json
{% endhighlight %}</p>
<h2>Installation Steps</h2>
<p>Install grunt-ng-constant and lodash to your local project directory</p>
<p>{% highlight bash %}
npm install grunt-ng-constant lodash --save-dev
{% endhighlight %}</p>
<p>(optional) If you're using grunt-jit: Add grunt-ng-constants to your grunt-jit.</p>
<p>{% highlight javascript %}
require('jit-grunt')(grunt, {
useminPrepare: 'grunt-usemin',
ngtemplates: 'grunt-angular-templates',
cdnify: 'grunt-google-cdn',
ngconstant: 'grunt-ng-constant'
});
{% endhighlight %}</p>
<p>We need to Add the Configuration JSON files to the Gruntfile. Add these lines to your Gruntfile.js. This should be at or near the top of the file. If you're Gruntfile is not at the root of your project, adjust conf1 and conf2 to match. lodash is included to merge both JSON files together</p>
<p>{% highlight javascript %}
var _ = require('lodash');</p>
<p>// Load the config file matching the 'profile' parameter, returns the default config + values from that file.
var buildConfig = function (profile) {
var conf1 = './config/config.json';
var conf2 = './config/config.' + profile + '.json';
if (!grunt.file.exists(conf2)) {
grunt.fail.warn('File ' + conf2 + ' doesn't exist.');
}</p>
<p>return _.merge(
grunt.file.readJSON(conf1),
grunt.file.readJSON(conf2)
);
};</p>
<p>{% endhighlight %}</p>
<p>Add the following grunt task inside your grunt.initConfig. This sets up the configurations to read the buildConfig and set it to an ENV file.</p>
<p>Replace the dest: path with you keep your scripts in your project. I only have a production and development environment.</p>
<p>{% raw %}
ngconstant: {
// Options for all targets
options: {
space: '  ',
wrap: '"use strict";\n\n {%= __ngModule %}',
name: 'config',
},
// Environment targets
development: {
options: {
dest: 'app/scripts/config.js'
},
constants: {
ENV: buildConfig('development')
}
},
production: {
options: {
dest: 'app/scripts/config.js'
},
constants: {
ENV: buildConfig('production')
}
}
},
{% endraw %}</p>
<p>Finally, in the build and serve tasks of Grunt, we'll need to call ngconstant to our setup. grunt build is for production, and grunt serve for development. I would add this task as the first or second task to be run</p>
<p>{% highlight javascript %}
grunt.registerTask('build', [
'clean:dist',
'ngconstant:production',
'wiredep',
'useminPrepare',
...
{% endhighlight %}</p>
<p>And for grunt serve</p>
<p>{% highlight javascript %}
grunt.registerTask('serve', 'Compile then start a connect web server', function (target) {
if (target === 'dist') {
return grunt.task.run(['build', 'connect:dist:keepalive']);
}</p>
<p>grunt.task.run([
'clean:server',
'ngconstant:development',
'wiredep',
...
{% endhighlight %}</p>
<p>Then for every module where you would use this, include config as a dependency, and inject ENV</p>
<p>{% highlight javascript %}
var app = angular.module('brandtinker.businessFactory',['config']);</p>
<p>function BusinessFactory($http, $q, ENV) {
var url = ENV.business.url;
{% endhighlight %}</p>
<p>Credits goes to <a href="http://onefootball.github.io/environment-dependent-configuration-files-with-angularjs-and-grunt/">onefootball</a> for this setup.</p></div></article></div></div><label for="sidebar-checkbox" class="sidebar-toggle"></label></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/tutorials/environmental-variables-for-angularjs/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-2e886965057c6c493c57.js"],"app":["/app-3bab03752071a27f3420.js"],"component---src-pages-about-js":["/component---src-pages-about-js-dea8bc1234c1a0c7f81c.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-ab1ed7afae1ea3d1ea0a.js"],"component---src-pages-index-js":["/component---src-pages-index-js-eb8bba1ffae8dbd85449.js"],"component---src-pages-resume-js":["/component---src-pages-resume-js-863511f2a9e84e7545b9.js"],"component---src-templates-blog-page-js":["/component---src-templates-blog-page-js-f50b6c64133b0f8a57d3.js"]};/*]]>*/</script><script src="/polyfill-2e886965057c6c493c57.js" nomodule=""></script><script src="/component---src-templates-blog-page-js-f50b6c64133b0f8a57d3.js" async=""></script><script src="/app-3bab03752071a27f3420.js" async=""></script><script src="/framework-ef6b9b91ed0b2fec9a9f.js" async=""></script><script src="/webpack-runtime-252066672f8c7e61a796.js" async=""></script></body></html>