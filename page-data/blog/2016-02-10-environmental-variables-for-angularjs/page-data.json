{"componentChunkName":"component---src-templates-blog-page-js","path":"/blog/2016-02-10-environmental-variables-for-angularjs/","result":{"data":{"markdownRemark":{"id":"a08850eb-5b6b-59ab-90d9-d4477d915357","html":"<p>When it came time to setup deploys for our AngularJS application, we had a few areas in our Services that had hard-coded API keys into the application. A lot of guides online have different ways of incorporating ng-constant into the build process. At <a href=\"http://frshlns.com/\">Fresh Lines</a>, I work on a lot of server-side projects. I'm comfortable with a standard convention for my configurations, like a /config folder to store environment based settings.</p>\n<p>This particular setup is based on <a href=\"http://onefootball.github.io/environment-dependent-configuration-files-with-angularjs-and-grunt/\">onefootball</a>'s guide, and mirrors closely to how some server side frameworks have handled their environmental variables.</p>\n<h2>Intended Usage</h2>\n<p>I want to have a nice config file, that lists all my environment specific settings, like</p>\n<p>{% highlight json %}\n{\n\"business\": {\n\"url\": \"<a href=\"http://tommylee.co\">http://tommylee.co</a>\"\n}\n}\n{% endhighlight %}\nand in config.production.json.\n{% highlight json %}\n{\n\"business\": {\n\"url\": \"<a href=\"http://frshlns.com\">http://frshlns.com</a>\"\n}\n}\n{% endhighlight %}</p>\n<p> then have the ability to inject the configuration into places where I need it.</p>\n<p>{% highlight javascript %}\nvar app = angular.module('brandtinker.businessFactory',['config']);</p>\n<p>function BusinessFactory($http, $q, ENV) {\nvar url = ENV.business.url;\n...\n}\n{% endhighlight %}</p>\n<h2>Requirements</h2>\n<ul>\n<li>An AngularJS Application</li>\n<li>A (Gruntfile)<a href=\"https://github.com/werk85/grunt-ng-constant\">gruntjs</a> that works</li>\n</ul>\n<h3>Folder Structure</h3>\n<p>The project folders would be set up so that we have a separate config folder to hold all of the private information:</p>\n<p>{% highlight bash %}\n/app\n/config\n/Gruntfile.js\n{% endhighlight %}</p>\n<p>In this config folder, we'll have the following files. These files represent the different environments we want.</p>\n<p>{% highlight bash %}\n./config.json\n./config.production.json\n./config.development.json\n./config.staging.json\n{% endhighlight %}</p>\n<h2>Installation Steps</h2>\n<p>Install grunt-ng-constant and lodash to your local project directory</p>\n<p>{% highlight bash %}\nnpm install grunt-ng-constant lodash --save-dev\n{% endhighlight %}</p>\n<p>(optional) If you're using grunt-jit: Add grunt-ng-constants to your grunt-jit.</p>\n<p>  {% highlight javascript %}\nrequire('jit-grunt')(grunt, {\nuseminPrepare: 'grunt-usemin',\nngtemplates: 'grunt-angular-templates',\ncdnify: 'grunt-google-cdn',\nngconstant: 'grunt-ng-constant'\n});\n{% endhighlight %}</p>\n<p>We need to Add the Configuration JSON files to the Gruntfile. Add these lines to your Gruntfile.js. This should be at or near the top of the file. If you're Gruntfile is not at the root of your project, adjust conf1 and conf2 to match. lodash is included to merge both JSON files together</p>\n<p>{% highlight javascript %}\nvar _ = require('lodash');</p>\n<p>// Load the config file matching the 'profile' parameter, returns the default config + values from that file.\nvar buildConfig = function (profile) {\nvar conf1 = './config/config.json';\nvar conf2 = './config/config.' + profile + '.json';\nif (!grunt.file.exists(conf2)) {\ngrunt.fail.warn('File ' + conf2 + ' doesn't exist.');\n}</p>\n<p>  return _.merge(\ngrunt.file.readJSON(conf1),\ngrunt.file.readJSON(conf2)\n);\n};</p>\n<p>{% endhighlight %}</p>\n<p>Add the following grunt task inside your grunt.initConfig. This sets up the configurations to read the buildConfig and set it to an ENV file.</p>\n<p>Replace the dest: path with you keep your scripts in your project. I only have a production and development environment.</p>\n<p>{% raw %}\nngconstant: {\n// Options for all targets\noptions: {\nspace: '  ',\nwrap: '\"use strict\";\\n\\n {%= __ngModule %}',\nname: 'config',\n},\n// Environment targets\ndevelopment: {\noptions: {\ndest: 'app/scripts/config.js'\n},\nconstants: {\nENV: buildConfig('development')\n}\n},\nproduction: {\noptions: {\ndest: 'app/scripts/config.js'\n},\nconstants: {\nENV: buildConfig('production')\n}\n}\n},\n{% endraw %}</p>\n<p>Finally, in the build and serve tasks of Grunt, we'll need to call ngconstant to our setup. grunt build is for production, and grunt serve for development. I would add this task as the first or second task to be run</p>\n<p>{% highlight javascript %}\ngrunt.registerTask('build', [\n'clean:dist',\n'ngconstant:production',\n'wiredep',\n'useminPrepare',\n...\n{% endhighlight %}</p>\n<p>  And for grunt serve</p>\n<p>{% highlight javascript %}\ngrunt.registerTask('serve', 'Compile then start a connect web server', function (target) {\nif (target === 'dist') {\nreturn grunt.task.run(['build', 'connect:dist:keepalive']);\n}</p>\n<p>  grunt.task.run([\n'clean:server',\n'ngconstant:development',\n'wiredep',\n...\n{% endhighlight %}</p>\n<p>Then for every module where you would use this, include config as a dependency, and inject ENV</p>\n<p>{% highlight javascript %}\nvar app = angular.module('brandtinker.businessFactory',['config']);</p>\n<p>function BusinessFactory($http, $q, ENV) {\nvar url = ENV.business.url;\n{% endhighlight %}</p>\n<p>Credits goes to <a href=\"http://onefootball.github.io/environment-dependent-configuration-files-with-angularjs-and-grunt/\">onefootball</a> for this setup. </p>","frontmatter":{"title":"Environmental Variables for AngularJS","date":"10 February, 2016"}}},"pageContext":{"slug":"/blog/2016-02-10-environmental-variables-for-angularjs/"}}}